language: c

addons:
    apt:
        packages:
            - lib32stdc++6
            - zip
            - unzip

env:
    matrix:
        - SMBRANCH=1.9
        - SMBRANCH=1.10
        - SMBRANCH=1.11
    global:
        - secure: "FWKtX3YFn30xhIEtlkxqBuW8z3/S43/zoxAJuHXTGM3CrCL8n6gsiRyqCJZP7f3Htv48h68SoHdYyihczMORObk0CxuOx0nzU6oasBEJDcinZ4pdcjxWLm0/GqPiW1KpC3xjoCB/SO7Vdocp6M0O/r/d67bjudHQ3mTVkCIpU/w="
        - secure: "rNihpg+iwnBcWeXYuPbBA4li/wlMbheLDRukeyTFXf2GFyLviCo4XtlGHg4ypm2kYqQHYnhMKlmrA8NnBv2V25BR+T12YKuB/n4hMlm4k7kI+i2w+7Gw4ePNaE0Or03sU90BXMYVgaoMG5VX4P6wxzqv4nNPjwDSeIGhEDWeptE="

before_script:
    - SMPACKAGE="http://sourcemod.net/latest.php?os=linux&version=${SMBRANCH}"
    - wget "$SMPACKAGE" -O latest.tar.gz
    - mkdir $SMBRANCH
    - tar xfz latest.tar.gz -C $SMBRANCH
    - export SMPATH=$(pwd)/$SMBRANCH/addons/sourcemod/scripting
    - mkdir plugins

script:
    - $SMPATH/spcomp scripting/steamgrouprestrict.sp
    - mv steamgrouprestrict*.smx plugins/
    - zip -q -9 -r steamgrouprestrict_gameserver.zip plugins/ scripting/

deploy:
    - provider: releases
      skip_cleanup: true
      api_key:
          secure: aluHVTVa3DatUISjPUUck1YNlOVqNiZI7F4Lk0DcTpGuSs38UtZYbxXXHibrq004LP/R1GvMxFZx0rkYDKJJyJw0HpoQlodsgm5T3g5OJAcHfrD8WcR0R5T5GBUBaTZ6copr5175TDhMcGTHTA66rFDmch7Sh1m86IVhwhlJbag=
      file:
          - plugins/steamgrouprestrict.smx
          - scripting/steamgrouprestrict.sp
          - steamgrouprestrict_gameserver.zip
      on:
          condition: "$SMBRANCH = 1.10"
          tags: true
          repo: Impact123/SteamGroupRestrict
          branches:
              only:
                  - master
                  - development